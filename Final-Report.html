<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Nguyen Tran">
<meta name="dcterms.date" content="2023-06-20">

<title>Quantium Retail Analytics Final Report</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="Final-Report_files/libs/clipboard/clipboard.min.js"></script>
<script src="Final-Report_files/libs/quarto-html/quarto.js"></script>
<script src="Final-Report_files/libs/quarto-html/popper.min.js"></script>
<script src="Final-Report_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Final-Report_files/libs/quarto-html/anchor.min.js"></script>
<link href="Final-Report_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Final-Report_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Final-Report_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Final-Report_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Final-Report_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods">Methods</a>
  <ul class="collapse">
  <li><a href="#task-1" id="toc-task-1" class="nav-link" data-scroll-target="#task-1">Task 1</a></li>
  <li><a href="#task-2" id="toc-task-2" class="nav-link" data-scroll-target="#task-2">Task 2</a></li>
  <li><a href="#task-3" id="toc-task-3" class="nav-link" data-scroll-target="#task-3">Task 3</a></li>
  </ul></li>
  <li><a href="#conclusions" id="toc-conclusions" class="nav-link" data-scroll-target="#conclusions">Conclusions</a>
  <ul class="collapse">
  <li><a href="#task-1-1" id="toc-task-1-1" class="nav-link" data-scroll-target="#task-1-1">Task 1</a></li>
  <li><a href="#task-2-1" id="toc-task-2-1" class="nav-link" data-scroll-target="#task-2-1">Task 2</a></li>
  <li><a href="#task-3-1" id="toc-task-3-1" class="nav-link" data-scroll-target="#task-3-1">Task 3</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  <li><a href="#appendix-a-raw-data" id="toc-appendix-a-raw-data" class="nav-link" data-scroll-target="#appendix-a-raw-data">Appendix A: Raw Data</a></li>
  <li><a href="#appendix-b-magnitude-distance" id="toc-appendix-b-magnitude-distance" class="nav-link" data-scroll-target="#appendix-b-magnitude-distance">Appendix B: Magnitude distance</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Quantium Retail Analytics Final Report</h1>
<p class="subtitle lead">Customer Patterns and Trial Layout Performance</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p><a href="https://www.linkedin.com/in/nguyen-tran-unt/">Nguyen Tran</a> </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 20, 2023</p>
    </div>
  </div>
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="abstract-title">Abstract</div>
    <p>As part of Quantium’s retail analytics team, we have been approached by our client Julia, the Category Manager for Chips, who wants to better understand the types of customers who purchase Chips and their purchasing behaviour within the region. She has also asked us to test the impact of the new trial layouts with a data driven recommendation to whether or not the trial layout should be rolled out to all their stores. We generated insights and provided commercial recommendations based on the provided data sets, identified benchmark stores based on two statistical measures to test the impact of the trial store layouts on customer sales, and presented a comprehensive client report in PowerPoint, introducing the actionable results and then getting into the why’s and how’s. In completion, we communicated statistical evidence to client, confirming the success of the trial layout, and recommended its deployment across all stores.</p>
  </div>
</div>

</header>

<p>Note: This is a <a href="https://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=&amp;cad=rja&amp;uact=8&amp;ved=2ahUKEwi0rLr-qqSBAxXClWoFHdOKCcUQFnoECBQQAQ&amp;url=https%3A%2F%2Fwww.theforage.com%2Fvirtual-internships%2Fprototype%2FNkaC7knWtjSbi6aYv%2FData-Analytics&amp;usg=AOvVaw0A0M2eX5jkAFxFYC12EzZX&amp;opi=89978449">virtual experience project</a> provided by theforage.com, done by Nguyen Tran.</p>
<p>For the full analysis with code, visit <a href="https://rpubs.com/harisht9/1070880">Task 1</a> and <a href="https://rpubs.com/harisht9/1070882">Task 2</a>.</p>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Quantium has had a data partnership with a large supermarket brand for the last few years who provide transaction and customer data. We are responsible for delivering highly valued data analytics and insights to help the business make strategic decisions.&nbsp;</p>
<p>Supermarkets will regularly change their store layouts, product selections, prices and promotions. This is to satisfy their customer’s changing needs and preferences, keep up with the increasing competition in the market or to capitalize on new opportunities. The Quantium analytics team is engaged in these processes to evaluate and analyse the performance of change and recommend whether it has been successful.</p>
<p>Our client Julia has provided two data sets: customer transaction data and purchase behavior, spanning from July 2018 to June 2019 (to see what the data sets look like, visit <a href="#appendix-a-raw-data">Appendix A: Raw Data</a>). We need to present a strategic recommendation to Julia that is supported by data which&nbsp;she can then use for the upcoming category review however to do so we need to analyse the data to understand the current purchasing trends and behaviors. The client is particularly interested in customer segments and their chip purchasing behavior. She has also asked us to evaluate the performance of a store trial which was performed in stores 77, 86 and 88, and provide data-driven recommendations on whether they should be implemented across all their stores. The trial period is from February 2019 to the end of April 2019.</p>
<p>&nbsp;&nbsp;</p>
<p>Our approach for this client problem is broken down into three tasks:</p>
<ol type="1">
<li><strong>Data preparation and customer analytics</strong></li>
</ol>
<p>Conduct analysis on client’s transaction data set and identify customer purchasing behaviors to generate insights and provide commercial recommendations.</p>
<ol start="2" type="1">
<li><strong>Experimentation and uplift testing</strong></li>
</ol>
<p>Extend analysis from Task 1 to identify benchmark stores that allow us to test the impact of the trial store layouts on customer sales.</p>
<ol start="3" type="1">
<li><strong>Analytics and commercial application</strong></li>
</ol>
<p>Use analytics and insights from Task 1 and 2 to prepare a report for the client.</p>
</section>
<section id="methods" class="level1">
<h1>Methods</h1>
<p>In this section, we go over what we did for each task.</p>
<section id="task-1" class="level2">
<h2 class="anchored" data-anchor-id="task-1">Task 1</h2>
<section id="data-cleaning" class="level3">
<h3 class="anchored" data-anchor-id="data-cleaning">Data Cleaning</h3>
<p>The first step in any analysis is to first understand the data. We looked at each of the data sets provided and found some data cleaning to do before exploring.</p>
<p>&nbsp;&nbsp;</p>
<p><strong>Examining transaction data:</strong> identified inconsistencies, no missing data, one outlier where 200 packets of chips are bought in one transaction (this customer has only had the two transactions over the year and is not an ordinary retail customer; the customer might be buying chips for commercial purposes instead; Thus, we removed these two transactions from further analysis), and items other than chips in product’s name column such as salsa products.</p>
<p><strong>Examining customer data:</strong> checked for similar issues in the customer data, no missing data, merged the transaction and customer data together so it’s ready for the analysis.</p>
<p>&nbsp;</p>
<p>Next, we dived into exploring the data.</p>
</section>
<section id="analysis-on-customer-segments" class="level3">
<h3 class="anchored" data-anchor-id="analysis-on-customer-segments">Analysis on customer segments</h3>
<p>- Defined the metrics of interest to the client</p>
<ul>
<li><p>Who spends the most on chips (total sales), describing customers by lifestage and how premium their general purchasing behavior is?</p></li>
<li><p>How many customers are in each segment?</p></li>
<li><p>How many chips are bought per customer by segment?</p></li>
<li><p>What’s the average chip price by customer segment?</p></li>
</ul>
<p>- Raised questions to our data team</p>
<ul>
<li><p>The customer’s total grocery spend over the period and total spend for each chips transaction to understand what proportion of their grocery spend is on chips.</p></li>
<li><p>Proportion of customers in each customer segment overall to compare against the mix of customers who purchase chips.</p></li>
</ul>
<p>- Created charts to visualize our findings</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/prop-sales-by-lifestage.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Note that the percentage of each tile is relative to the total sales.</figcaption>
</figure>
</div>
<p>Sales are coming mainly from Budget - older families, Mainstream - young singles/couples, and Mainstream - retirees</p>
<p>Let’s see if the higher sales are due to there being more customers who buy chips.</p>
<p><img src="img/prop-cust-lifestage.png" class="img-fluid"></p>
<p><img src="img/cust-lifestage.png" class="img-fluid"></p>
<p>There are more Mainstream - young singles/couples and Mainstream - retirees who buy chips. This contributes to there being more sales to these customer segments but this is not a major driver for the Budget - Older families segment.</p>
<p>Higher sales may also be driven by more units of chips being bought per customer.&nbsp;</p>
<p><img src="img/avg-unt-per-cust.png" class="img-fluid"></p>
<p>Older families and young families in general buy more chips per customer</p>
<p>What about the average price per unit chips bought for each customer segment as this is also a driver of total sales.</p>
<p><img src="img/avg-unit-lifestage-prem.png" class="img-fluid"></p>
<p>Mainstream midage and young singles and couples are more willing to pay more per packet of chips compared to their budget and premium counterparts. This may be due to premium shoppers being more likely to buy healthy snacks and when they buy chips, this is mainly for entertainment purposes rather than their own habit of consumption. This is also supported by there being fewer premium midage and young singles and couples buying chips compared to their mainstream counterparts.</p>
<p>As the difference in average price per unit isn’t large, we perform a t-test to see if this difference was statistically different.</p>
<p>Let mu_m be the mean unit price of mainstream midage and young singles and couples Let mu_pb be the mean unit price of premium and budget midage and young singles and couples</p>
<p><span class="math inline">\(H_0:\)</span> true difference in mu_m and mu_pb is equal to 0</p>
<p><span class="math inline">\(H_a:\)</span> true difference in mu_m and mu_pb is greater than 0</p>
<p>The t-test results in a p-value of 3.483677e-306, i.e.&nbsp;the unit price for mainstream, young and mid-age singles and couples ARE significantly higher than that of budget or premium, young and midage singles and couples.</p>
</section>
<section id="insights-for-specific-customer-segments" class="level3">
<h3 class="anchored" data-anchor-id="insights-for-specific-customer-segments">Insights for specific customer segments</h3>
<p>We have found quite a few interesting insights that we can dive deeper into.</p>
<p>We might want to target customer segments that contribute the most to sales to retain them or further increase sales. Let’s look at Mainstream - young singles/couples.</p>
<p>Do they tend to buy a particular brand of chips compared to other segments? We answered this with affinity analysis.</p>
<p><img src="img/affinity-brand.png" class="img-fluid" width="418"></p>
<p>Mainstream young singles/couples are 23% more likely to purchase Tyrrells chips compared to the rest of the population</p>
<p>Mainstream young singles/couples are 56% less likely to purchase Burger Rings compared to the rest of the population</p>
<p>Let’s also find out if our target segment tends to buy larger packs of chips.</p>
<p><img src="img/affinity-pack.png" width="412" height="474"></p>
<p>Mainstream young singles/couples are 27% more likely to purchase pack size of 270g compared to the rest of the population.</p>
<p>Mainstream young singles/couples are 56% less likely to purchase pack size of 220g compared to the rest of the population.</p>
<p>Furthermore, Twisties is the only brand that offers 270g pack size. This brand also comes in 2nd in our Brand Affinity analysis. This contributes to why our target segment buys a lot of this pack size.</p>
</section>
</section>
<section id="task-2" class="level2">
<h2 class="anchored" data-anchor-id="task-2">Task 2</h2>
<p>For this part of the project we examined the performance in trial vs control stores to provide a recommendation for each location based on our insight.</p>
<section id="control-store-selections" class="level3">
<h3 class="anchored" data-anchor-id="control-store-selections">Control Store Selections</h3>
<p>The client has selected store numbers 77, 86 and 88 as trial stores and want control stores to be established stores that are operational for the entire observation period.</p>
<p>We would want to match trial stores to control stores that are similar to the trial store prior to the trial period of Feb 2019 in terms of :</p>
<ul>
<li><p>Monthly overall sales revenue</p></li>
<li><p>Monthly number of customers</p></li>
<li><p>Monthly number of transactions per customer</p></li>
</ul>
<p>Thus, we created these metrics and filter to stores that are present throughout the pre-trial period.</p>
<p>&nbsp;</p>
<p>Next, we needed to work out a way of ranking how similar each potential control store is to the trial store. The two metrics we decided to use are:</p>
<ul>
<li>Pearson correlations: how correlated the performance of each store is to the trial store.</li>
</ul>
<!-- -->
<ul>
<li>Magnitude distance: a standardized metric based on the absolute difference between the trial store’s performance and each control store’s performance. For more information on this metric, visit <a href="#appendix-b-magnitude-distance">Appendix B: Magnitude distance</a>.</li>
</ul>
<p>We selected control stores based on how similar monthly total sales in dollar amounts and monthly number of customers are to the trial stores. So as we applied the two metrics, we would get four scores, two for each of total sales and total customers.</p>
<p>We then combined all the scores calculated by our two metrics to create a composite score to rank on.</p>
<p>We combined by taking a simple average of the correlation and magnitude scores for each driver. Note that if we consider it more important for the trend of the drivers to be similar, we can increase the weight of the correlation score (a simple average gives a weight of 0.5 to each metric) or if we consider the absolute size of the drivers to be more important, we can lower the weight of the correlation score.</p>
<p>Now, we would have a score for each of total number of sales and number of customers. We combined the two via a simple average.</p>
<p>The store with the highest score is then selected as the control store since it is most similar to the trial store.</p>
</section>
<section id="store-77-assessment" class="level3">
<h3 class="anchored" data-anchor-id="store-77-assessment">Store 77 Assessment</h3>
<p>For trial store 77, the control store is 233. We visualized to check if this is reasonable.</p>
<p><img src="img/77-sales.png" class="img-fluid"></p>
<p><img src="img/77-cust.png" class="img-fluid"></p>
<p>&nbsp;</p>
<p>We plotted the sales of the control store, the sales of the trial stores and the 95th percentile value of sales of the control store.</p>
<p><img src="img/tot-sales.png" class="img-fluid"></p>
<p>The results show that the trial in store 77 is significantly different to its control store in the trial period as the trial store performance lies outside the 5% to 95% confidence interval of the control store in two of the three trial months.</p>
<p><img src="img/total-cust.png" class="img-fluid"></p>
</section>
<section id="store-86-assessment" class="level3">
<h3 class="anchored" data-anchor-id="store-86-assessment">Store 86 Assessment</h3>
<p>For trial store 86, the control store is 155.</p>
<p><img src="img/tot-sales-86.png" class="img-fluid"></p>
<p>The results show that the trial in store 86 is not significantly different to its control store in the trial period as the trial store performance lies inside the 5% to 95% confidence interval of the control store in the two of the three trial months.</p>
<p><img src="img/tot-cust-86.png" class="img-fluid"></p>
<p>It looks like the number of customers is significantly higher in all of the three months. This seems to suggest that the trial had a significant impact on increasing the number of customers in trial store 86 but as we saw, sales were not significantly higher. We should check with the Category Manager if there were special deals in the trial store that were may have resulted in lower prices, impacting the results.</p>
</section>
<section id="store-88-assessment" class="level3">
<h3 class="anchored" data-anchor-id="store-88-assessment">Store 88 Assessment</h3>
<p>For trial store 88, the control store is 237.</p>
<p><img src="img/tot-sales-88.png" class="img-fluid"></p>
<p>The results show that the trial in store 88 is significantly different to its control store in the trial period as the trial store performance lies outside of the 5% to 95% confidence interval of the control store in two of the three trial months.</p>
<p><img src="img/tot-cust-88.png" class="img-fluid"></p>
<p>Total number of customers in the trial period for the trial store is not significantly higher than the control store for two out of three months, which indicates little to no effect by the trial.</p>
</section>
</section>
<section id="task-3" class="level2">
<h2 class="anchored" data-anchor-id="task-3">Task 3</h2>
<p>We created a <a href="https://drive.google.com/file/d/1AeIdwMsqvoDHT_8B5WD_j8donvpjYdoG/view?usp=share_link">client report in PowerPoint</a> to provide commercial, actionable insights from our analysis and displayed it in a clear and concise way for your client, with minimal jargon. We followed the Pyramid Principles, getting at the actionable findings and what to implement first, then backing them up with explanations later on.</p>
</section>
</section>
<section id="conclusions" class="level1">
<h1>Conclusions</h1>
<section id="task-1-1" class="level2">
<h2 class="anchored" data-anchor-id="task-1-1">Task 1</h2>
<p>Task 1 analysis serves as a precursor to more formal testing and analysis.</p>
<ul>
<li><p>Sales have mainly been due to Budget - older families, Mainstream - young singles/couples, and Mainstream - retirees shoppers.</p></li>
<li><p>Although Budget - older families accounts for the largest proportion of sales (8.7%), the amount of customers in this segment (6.5%) is not as great as the Mainstream - young singles/couples (11.1%) and Mainstream - retirees shoppers (8.9%)</p></li>
<li><p>This implies the sales can be further improved in the two Mainstream - young singles/couples and Mainstream - retirees shoppers segments</p></li>
<li><p>We also found out the Mainstream - young singles/couples are among the segments that bought the least units of chips per customer. However, they are willing to spend the most on chips.</p></li>
<li><p>Notable mention is Mainstream - young singles/couples, who are also willing to spend more on chips than others.</p></li>
<li><p>This implies that the Mainstream - young singles/couples prefer higher quality chips and/or more popular brands. Their most preferred brands are Tyrrells, Twisties, Doritos, Kettle, and Tostitos</p></li>
<li><p>Mainstream young singles/couples are 27% more likely to purchase pack size of 270g</p></li>
<li><p>270g seems to be the ideal pack size for Mainstream young singles/couples. However, the only brand that provides this pack size is Twisties in this store. Perhaps, including more brands with 270g pack size is a potential step towards more sales.</p></li>
<li><p>Overall, we suggest an emphasis on the Mainstream - young singles/couples. One suggestion would be to have some Tyrrells chips near areas in the store that this target segment tends to visit the most.</p></li>
</ul>
</section>
<section id="task-2-1" class="level2">
<h2 class="anchored" data-anchor-id="task-2-1">Task 2</h2>
<p>We’ve found control stores 233, 155, 237 for trial stores 77, 86 and 88 respectively.</p>
<p>The results for trial stores 77 during the trial period show a significant difference in at least two of the three trial months for both the total sales and number of customers metrics. Trial store 86 saw a statistically significant increase in customers but not total sales. Trial store 88 saw a statistically significant increase in sales but not customers.</p>
<p><img src="img/summary.png" class="img-fluid"></p>
<p>We can check with the client if the implementation of the trial was different in trial stores 86 and 88 but overall, the trial shows a positive effect on our metrics; two out of three stores had higher sales and two out of three stores also had higher number of customers. Now that we have finished our analysis, we can prepare our presentation to the Category Manager.</p>
</section>
<section id="task-3-1" class="level2">
<h2 class="anchored" data-anchor-id="task-3-1">Task 3</h2>
<p>In completion, we communicated statistical evidence to client, confirming the success of the trial layout, and recommended its deployment across all stores.</p>
</section>
</section>
<section id="references" class="level1">
<h1>References</h1>
<ul>
<li><p><a href="https://www.youtube.com/watch?v=icGS26TS1fE">Affinity Analysis</a></p></li>
<li><p><a href="https://cran.r-project.org/web/packages/data.table/vignettes/datatable-intro.html">Data table in R</a></p></li>
<li><p><a href="https://www.geeksforgeeks.org/measures-of-distance-in-data-mining/">Measures of Distance in Data Mining</a></p></li>
<li><p><a href="https://medium.com/lessons-from-mckinsey/the-pyramid-principle-f0885dd3c5c7">The Pyramid Principles</a></p></li>
<li><p><a href="https://www.statology.org/two-sample-t-test/">Two sample t-test</a></p></li>
</ul>
</section>
<section id="appendix-a-raw-data" class="level1">
<h1>Appendix A: Raw Data</h1>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/transaction-data.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Transaction data</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="img/customer-data.png" class="img-fluid figure-img" width="499"></p>
<figcaption class="figure-caption">Customer data</figcaption>
</figure>
</div>
</section>
<section id="appendix-b-magnitude-distance" class="level1">
<h1>Appendix B: Magnitude distance</h1>
<p>i.e.&nbsp;1 - (Observed distance – minimum distance)/(Maximum distance – minimum distance)</p>
<ul>
<li><p>The fraction (Observed distance - Minimum distance) / (Maximum distance - Minimum distance) represents the relative position of the observed distance within the entire range of possible distances.</p></li>
<li><p>By subtracting the fraction (Observed distance - Minimum distance) / (Maximum distance - Minimum distance) from 1, we obtain a value that reflects the similarity between the trial store and the control store.</p>
<ul>
<li>With (Observed distance - Minimum distance) / (Maximum distance - Minimum distance), the lowest measure means highest similarity</li>
</ul></li>
<li><p>A value of 1 indicates maximum similarity (when the observed distance equals the minimum distance), while a value of 0 indicates minimum similarity (when the observed distance equals the maximum distance).</p></li>
</ul>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>